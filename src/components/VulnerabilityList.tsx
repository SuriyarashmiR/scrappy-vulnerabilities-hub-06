
import React, { useState, useEffect } from 'react';
import VulnerabilityCard, { Vulnerability } from './VulnerabilityCard';
import { cn } from '@/lib/utils';

interface CompanyData {
  id: string;
  name: string;
  logo: string;
  grade: string;
  vulnerabilities: Vulnerability[];
}

const companiesData: CompanyData[] = [
  {
    id: '1',
    name: 'Windows',
    logo: 'https://upload.wikimedia.org/wikipedia/commons/thumb/5/5f/Windows_logo_-_2012.svg/1024px-Windows_logo_-_2012.svg.png',
    grade: '9.8',
    vulnerabilities: [
      { id: '1-1', type: 'warning', description: 'CVE_ID:CVE-2024-0001.' },
      { id: '1-2', type: 'warning', description: 'DESCRIPTION:EternalBlue is a critical security vulnerability in Microsofts implementation of the Server Message Block (SMB) protocol' },
      { id: '1-3', type: 'warning', description: 'SEVERITY:HIGH' },
      { id: '1-4', type: 'warning', description: 'OEM:MICROSOFT' },
      { id: '1-5', type: 'info', description: 'PUBLISHED DATA:2024-03-02' },
    ]
  },
  {
    id: '2',
    name: 'NVIDIA',
    logo: 'https://upload.wikimedia.org/wikipedia/commons/thumb/2/21/Nvidia_logo.svg/1024px-Nvidia_logo.svg.png',
    grade: '8.',
    vulnerabilities: [
      { id: '2-1', type: 'info', description: 'CVE_ID:CVE-2017-0144' },
      { id: '2-2', type: 'info', description: 'DESCRIPTION:This high-severity vulnerability exists within NVIDIAs vGPU software, specifically in the Virtual GPU Manager' },
      { id: '2-3', type: 'info', description: 'SEVERITY:HIGH' },
      { id: '2-4', type: 'info', description: 'OEM:NVDIA' },
      { id: '2-5', type: 'info', description: 'PUBLISHED DATA:2024-02-26' },
    ]
  }
];

interface VulnerabilityListProps {
  title?: string;
  globalExpanded?: boolean;
  onExpandChange?: (expanded: boolean) => void;
}

const VulnerabilityList: React.FC<VulnerabilityListProps> = ({ 
  title, 
  globalExpanded,
  onExpandChange 
}) => {
  const [expanded, setExpanded] = useState(false);
  
  // Sync local expanded state with global state when it changes
  useEffect(() => {
    if (globalExpanded !== undefined) {
      setExpanded(globalExpanded);
    }
  }, [globalExpanded]);

  const handleExpandToggle = () => {
    const newExpandedState = !expanded;
    setExpanded(newExpandedState);
    
    // Notify parent component about the state change
    if (onExpandChange) {
      onExpandChange(newExpandedState);
    }
  };

  return (
    <div className="w-full animate-fade-up rounded-xl p-4 bg-white dark:bg-gray-800/60 shadow-sm border border-gray-100 dark:border-gray-700">
      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
        {companiesData.map((company, index) => (
          <VulnerabilityCard
            key={company.id}
            company={company.name}
            logo={company.logo}
            grade={company.grade}
            vulnerabilities={company.vulnerabilities}
            animationDelay={0.1 * index}
            forceExpanded={expanded}
          />
        ))}
      </div>
    </div>
  );
};

export default VulnerabilityList;
